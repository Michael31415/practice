\documentclass[titlepage]{article}
\usepackage[ukrainian]{babel}
\usepackage{listings}
\usepackage{amsmath}
\usepackage{fontspec}
\setmainfont{Times New Roman}
\usepackage{setspace}
\spacing{1.7}
\usepackage{fancyhdr}
\usepackage{titling}
\usepackage[a4paper, top = 20mm, bottom = 20mm, left = 25mm, right = 15mm]{geometry}
\usepackage{graphics}

\lstset{
	basicstyle=\large,
	breaklines = true,
	language = matlab,
	breakatwhitespace = true,
	numbers = left,
	numberstyle = \tiny,
	columns = flexible,
	frame=tb,
	tabsize=4
}

\makeatletter
\renewcommand\normalsize{%
\@setfontsize\normalsize{14pt}{15pt}}
\makeatother

\newcommand\makelisting[1]{\begingroup\spacing{1}\lstinputlisting[title=#1]{../#1} \vspace{1cm} \endgroup}
\newcommand\mysection[1]{\begingroup\center\section*{#1}\endgroup}
\newcommand\eq[1]{\begin{equation*}\begin{split}#1\end{split}\end{equation*}}

\preauthor{\begin{flushright}}
\postauthor{\end{flushright}}

\fancypagestyle{empty}{%
	\renewcommand{\headrulewidth}{0pt}
	\cfoot{\normalsize2016}
	\chead{\uppercase{київський національний університет імені тараса шевченка}}
}

\begin{document}

\title{\normalsize Учбова практика \protect\\ Побудова інтерполяційного сплайну}
\author{\vspace{5cm}Виконав: \protect\\ студент 4-го курсу \protect\\ спеціальність математика \protect\\ Чаповський Євгеній}
\date{}
\maketitle
\mysection{Постановка задачі}
Необхідно побудувати інтерполяційний сплайн $S(x, u)$ другого степеня дефекту 1, з крайовими умовами типу II, використовуючи метод $2m$ для пошуку системи лінійних рівнянь та метод монотонної лівої для розв'язання цієї системи.
\mysection{Теоретичні відомості}
Інтерполяційний сплайн другого степеня дефекту 1 --- це така функція $S(x, u) \in C^1([a,b])$, що для інтерполяційної сітки $X$ та функції $u$ виконується:
\[\forall x \in [X_i, X_{i+1}): S(x, u)=a_2^i(x-X_i)^2 - a_1^i(x-X_i) + a_0^i; \forall i: S(X_i, u) = u(X_i).\]
Попередні умови породжують обмеження на коефіцієнти, а саме: $2n$ обмежень випливає з необхідності рівності сплайну та функції у вузлах сітки (по два обмеження на кожний відрізок $[x_i, x_{i+1}]$) та $n-1$ обмеження через неперервність похідної (по одному в кожній внутрішній точці сітки). З двома крайовими умовами отримуємо $3n+1$ обмеження, але тільки $3n$ змінних, тому таку задачу неможливо розв'язати в загальному випадку. Вихід з цієї ситуації --- використання нової сплайнової сітки $\{x_i\} \subset [a,b]$, точки якої зазвичай кладуть посередині відрізків інтерполяційної сітки:
\[x_i = (X_{i-1} + X_{i}) / 2,  i=\overline{2,n};\quad x_1 = X_1, x_{n+1} = X_{n+1}.\]
Тоді
\[\forall x \in [x_i, x_{i+1}): S(x, u)=a_2^i(x-X_i)^2 - a_1^i(x-X_i) + a_0^i; \forall i: S(X_i, u) = u(X_i). \]
Тоді кількість змінних і кількість умов співпадає.

Для побудови системи рівнянь для коефіціентів використаємо перші похідні $a_1^i = m_i = S^{'}(X_i, u)$. Використовуючи рівність поділених різниць сплайну та інтерпольованої функціі в точках $X$ отримуємо обмеження на $m_i$:
\eq{
&h_im_{i-1} + 3(h_{i-1} + h_i)m_i + h_{i-1}m_{i+1} = 4(h_{i-1}u(X_i; X_{i+1}) + h_iu(X_{i-1}; X_i))\\
}
Де $h_i = X_{i+1} - X_i$. Тоді, з урахуванням крайових умов, отримуємо систему рівнянь:
\eq{
&3m_1 + m_2 = 4u(X_1, X_2)-h_1A;\\
&h_im_{i-1} + 3(h_{i-1} + h_i)m_i + h_{i-1}m_{i+1} = 4(h_{i-1}u(X_i; X_{i+1}) + h_iu(X_{i-1}; X_i)),\\
& i = \overline{2,n-1};\\
&m_{n-1} + 3m_n = 4u(X_{n-1}, X_n) + h_{n-1}B;
}
Для якої можна записати матрицю
\[\left(\begin{array}{cccc|c}
3 & 1 & 0 & \ldots  & 4u(X_1, X_2)-h_1A\\
h_2 & 3(h_1 + h_2) & h_1 & \ldots & 4(h_{1}u(X_1; X_{2}) + h_2u(X_{1}; X_2)) \\
\ldots &\ldots &\ldots &\ldots & \ldots\\
\ldots &h_{n-1} & 3(h_{n-2} + h_{n- 1}) & h_{n-2} & 4(h_{n-2}u(X_{n-1}; X_{n}) + h_{n-1}u(X_{n-2}; X_{n-1}))\\
 \ldots & 0  & 1 & 3 & 4u(X_{n-1}, X_n) + h_{n-1}B
\end{array}\right)\]
З теорії побудови сплайну відомо, що отримана система матиме властивість діагонального домінування, тому метод монотонної лівої прогонки гарантовано знайде розв'язок.

Для обрахування саме коефіціентів сплайну використовуються наступні формули:
\eq{
&a_0^i = u_i;\\
&a_1^i = m_i;\\
&a_2^1 = h_1^{-1}(2u(X_1;X_2) - 0.5(3m_1+m_2));\\
&a_2^i = h_{i-1}^{-1}(0.5(m_{i-1}+3m_i) - 2u(X_{i-1}; X_i)), \quad i=\overline{2,n}.
}
\mysection{Практична реалізація}
В практичній реалізаціі з метою упорядкування коду створено декілька функцій та трохи змінено їх роль у программі. Обрахунок сплайну в точках сітки $T$ відбувається безпосередньо в головній (перевіряючій) частині та ця сітка не передається в функцію що будує сплайн. Дійсно, для побудови сплайну не має бути важливо в яких точках він буде потім обраховуватись. Ця функція, що могла би називатися $spl\_22$, в реалізаціі має назву $CreateSpline$, вона повертає коефіціенти побудованого сплайну (як матрицю $3\times n$) та функцію, що обраховує сплайн та його похідні. 

Функція, що здійснює перевірку правильності побудови сплайну: побудову графіків та розрахунок сіткової норми.
\makelisting{main.m}
Функція, що здійснює побудову сплайна.
\makelisting{CreateSpline.m}
Побудова матриці за допомогою перших похідних $m_i$.
\makelisting{CreateSEMatrix.m}
Розв'язання системи лінійних рівнянь за допомогою методу квадратного кореня.
\makelisting{SolveSE.m}
Формування коефіцієнтів сплайну.
\makelisting{FormSpline.m}
\end{document}